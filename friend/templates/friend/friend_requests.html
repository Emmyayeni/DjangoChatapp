{% extends 'base.html' %}
{% load static %}

{% block content %}

<main class="container py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
            <div class="card border-0 shadow-sm rounded-lg" style="min-height: 80vh;">
                <div class="card-header bg-white border-bottom-0 pt-4 px-4 pb-0">
                    <h2 class="h3 fw-bold mb-3">Friend Requests</h2>
                    
                    <!-- Tabs or Filters -->
                    <div class="d-flex gap-2 mb-3 overflow-auto pb-2">
                        <a class="btn btn-primary rounded-pill px-3 fw-bold" href="#">Requests</a>
                        <a class="btn btn-light rounded-pill px-3 fw-bold" href="#">Suggestions</a>
                        <a class="btn btn-light rounded-pill px-3 fw-bold" href="#">Your Friends</a>
                    </div>
                </div>
                
                <div class="card-body p-4">
                    {% if friend_requests %}
                    <div class="row g-3">
                        {% for request in friend_requests %}
                        <div class="col-12 col-md-6 mb-3">
                             <div class="friend-card card h-100 border-0 shadow-sm p-3">
                                <div class="d-flex align-items-center gap-3 mb-3">
                                    <a href="{% url 'account:view' user_id=request.sender.id %}" class="avatar avatar--medium">
                                        <img src="{{request.sender.profile_image.url}}" alt="{{request.sender.username}}" class="rounded-circle" style="width: 60px; height: 60px; object-fit: cover;">
                                    </a>
                                    <div class="flex-grow-1 overflow-hidden">
                                        <a href="{% url 'account:view' user_id=request.sender.id %}" class="text-decoration-none text-dark">
                                            <h4 class="mb-1 fw-bold text-truncate" style="font-size: 1rem;">{{request.sender.username}}</h4>
                                        </a>
                                        <small class="text-muted d-block text-truncate">Sent a request</small>
                                    </div>
                                </div>
                                <div class="d-flex gap-2 mt-auto">
                                    <button class="btn btn-primary w-100 fw-bold py-2" id="id_confirm_{{request.sender.id}}" onclick='triggerAcceptFriendRequest("{{request.id}}")' style="font-size: 0.9rem;">Confirm</button>
                                    <button class="btn btn-light w-100 fw-bold py-2 text-dark" id="id_cancel_{{request.sender.id}}" onclick='triggerDeclineFriendRequest("{{request.id}}")' style="font-size: 0.9rem;">Delete</button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="d-flex flex-column align-items-center justify-content-center py-5 h-100 mt-5">
                        <div class="text-muted opacity-50 mb-3">
                            <i class="fas fa-users-slash fa-4x"></i>
                        </div>
                        <h4 class="fw-bold mb-2">No Friend Requests</h4>
                        <p class="text-muted">You don't have any pending requests right now.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            {% if other_users %}
            <div class="card border-0 shadow-sm rounded-lg mt-4">
                <div class="card-header bg-white border-bottom-0 pt-4 px-4 pb-0">
                    <h2 class="h4 fw-bold mb-0">People You May Know</h2>
                </div>
                <div class="card-body p-4">
                     <div class="row g-3">
                        {% for user in other_users %}
                        <div class="col-12 col-md-6 mb-3">
                            <div class="friend-card card h-100 border-0 shadow-sm p-3">
                                 <div class="d-flex align-items-center gap-3 mb-3">
                                    <a href="{% url 'account:view' user_id=user.id %}" class="avatar avatar--medium">
                                        <img src="{{user.profile_image.url}}" alt="{{user.username}}" class="rounded-circle" style="width: 60px; height: 60px; object-fit: cover;">
                                    </a>
                                    <div class="flex-grow-1 overflow-hidden">
                                        <a href="{% url 'account:view' user_id=user.id %}" class="text-decoration-none text-dark">
                                            <h4 class="mb-1 fw-bold text-truncate" style="font-size: 1rem;">{{user.username}}</h4>
                                        </a>
                                    </div>
                                </div>
                                <a href="{% url 'account:view' user_id=user.id %}" class="btn btn-light btn-sm text-primary fw-bold w-100">View Profile</a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</main>


<script type="text/javascript">
	function onFriendRequestAccepted(){
		location.reload();
	}

	function onFriendRequestDeclined(){
		location.reload();
	}

	function triggerAcceptFriendRequest(friend_request_id){
		acceptFriendRequest(friend_request_id, onFriendRequestAccepted)
	}

	function triggerDeclineFriendRequest(friend_request_id){
		declineFriendRequest(friend_request_id, onFriendRequestDeclined)
	}
</script>

{% include 'friend/snippets/accept_friendrequest.html' %}
{% include 'friend/snippets/decline_friend_request.html' %}

{% endblock content %}