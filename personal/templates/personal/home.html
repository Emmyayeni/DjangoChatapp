{% extends 'base.html' %}
{% load static %}
{% block content %}
<main class="layout layout--3 pt-5">
    <!-- Topics Start -->
    <div class="topics">
        <div class="topics__header">
            <h2>Browse Topics</h2>
        </div>
        <ul class="topics__list">
            <li>
                <a href="/?q=discover-rooms" class="active">All <span>{{topics.count}}</span></a>
            </li>
            {% for topic in topics %}        
            <li>
                <a href="/?q={{topic.name}}">{{topic.name}}
                    <!-- <span class="topic-follow" data-action="follow" data-id="..." data-url="...">Follow</span> -->
                </a>
            </li>
            {% endfor %}
        </ul>
        <a class="btn btn--link" href="/topics/">
            More
            <i class="fas fa-chevron-down"></i>
        </a>
    </div>
    <!-- Topics End -->

    <!-- Room List Start -->
    <div class="roomList">
        <div class="roomList__header">
            <div>
                <h2>Rooms</h2>
                <p>{{everychat}} Rooms available</p>
            </div>
            <a class="btn btn--main" href="{% url 'public:create-room' %}">
                <i class="fas fa-plus"></i>
                Create Room
            </a>
        </div>

        <!-- Mobile/Tablet View: Show "All Rooms" link if needed, or maybe filters -->
        <!-- <div><a href="/?q=discover-rooms">All Rooms</a></div> -->

        <!-- Carousel for Acts (if this was intended for featured users/rooms) -->
        {% if acts %}
        <div class="colm mb-4">
            <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    {% for act in acts %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <div class="activities__box">
                            <div class="activities__boxHeader roomListRoom__header">
                                <a href="{% url 'account:view' user_id=act.id %}" class="roomListRoom__author">
                                    <div class="avatar avatar--small">
                                        <img src="{{act.profile_image.url}}" alt="{{act.username}}">
                                    </div>
                                    <p>
                                        @{{act.username}}
                                        <!-- <span> last seen ...</span> -->
                                    </p>
                                </a>
                            </div>
                            <div class="activities__boxContent">
                                <button class="btn btn--main btn--pill" onclick="createOrReturnPrivateChat('{{act.id}}')">Message</button>
                                <a class="btn btn--main btn--pill" href="{% url 'account:view' user_id=act.id %}">View</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        {% endif %}

        {% for room in public_room %} 
        <div class="roomListRoom">
            <div class="roomListRoom__header">
                <a href="{% url 'account:view' user_id=room.host.id %}" class="roomListRoom__author">
                    <div class="avatar avatar--small">
                        <img src="{{room.host.profile_image.url}}" alt="{{room.host.username}}">
                    </div>
                    <span>Host @{{room.host.username}}</span>
                </a>
                <div class="roomListRoom__actions">
                    <span>{{room.created|timesince}} ago</span>
                </div>
            </div>
            <div class="roomListRoom__content">
                <a href="{% url 'public:room' pk=room.id %}"><h3>{{room.name}}</h3></a>
                <div class="roomListRoom__participants">
                    {% for user in room.participants.all|slice:":5" %}
                    <a href="{% url 'account:view' user_id=user.id %}" title="{{user.username}}">
                        <div class="avatar avatar--small">
                            <img src="{{user.profile_image.url}}" alt="{{user.username}}">
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            <div class="roomListRoom__meta">
                <a href="{% url 'public:room' pk=room.id %}" class="roomListRoom__joined">
                    <i class="fas fa-users"></i>
                    {{room.participants.count}} Joined
                </a>
                <p class="roomListRoom__topic">{{room.topic}}</p>
            </div>
        </div>
        {% endfor %}

        <!-- Pagination -->
        <div class="pagination">
            <ul class="pagination-list">
                {% if public_room.has_previous %}
                <li><a href="?page=1" class="btn page-link btn--sub">&laquo; First</a></li>
                <li><a href="?page={{public_room.previous_page_number}}" class="btn page-link">Previous</a></li>
                {% endif %}
                
                <li><span class="btn btn--sub disabled">Page {{public_room.number}} of {{public_room.paginator.num_pages}}</span></li>
                
                {% if public_room.has_next %}
                <li><a href="?page={{public_room.next_page_number}}" class="btn page-link">Next</a></li>
                <li><a href="?page={{public_room.paginator.num_pages}}" class="btn page-link">Last &raquo;</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
    <!-- Room List End -->

    <!-- Activities Start -->
    <div class="activities">
        <div class="activities__header">
            <h2>Friends you may know</h2>
        </div>
        {% for user in acts %}
        <div class="activities__box">
            <div class="activities__boxHeader roomListRoom__header">
                <a href="{% url 'account:view' user_id=user.id %}" class="roomListRoom__author">
                    <div class="avatar avatar--small">
                        <img src="{{user.profile_image.url}}" alt="{{user.username}}">
                    </div>           
                    <p>@{{user.username}}</p>
                </a>
                <!-- Add Friend Logic Here if needed -->
                <!-- <button class="btn btn--main btn--sm">Add</button> -->
            </div>
        </div>
        {% endfor %}
    </div>
    <!-- Activities End -->
</main>
{% endblock content %}